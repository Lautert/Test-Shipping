/*! Application - v0.0.0 - 2019-12-07 */
$(document).ready(function(){var t=[{id:1,name:"Apple",price:20},{id:2,name:"Banana",price:10},{id:3,name:"Orange",price:30}],n=$(".content-product-list ul");t.map(function(t,i){var e=n.find(".model").clone();e.removeClass("model"),e.find('input[type="hidden"]').val(t.id),e.find(".name").text(t.name),e.find(".unit").text("$ "+t.price),e.find(".total").text("$ 0"),e.find(".amount-component input").attr("name","amount["+t.id+"]"),e.find(".amount").AmountComponent(),n.append(e)});var i=[{id:1,name:"A",text:"(30%)",benefit:{subtotal:{reduce:{percentage:30}}}},{id:2,name:"FOO",text:"$ 100",benefit:{total:{reduce:{fixed:100}}},conditions:[{total:{min:101}}]},{id:3,name:"C",text:"Free Shipping",benefit:{shipping:{value:{fixed:0}}},conditions:[{subtotal:{min:300.5,max:400}}]}],e=[{code:"111",id:1},{code:"222",id:2},{code:"333",id:3}],o=[{rule:{shipping:{value:{fixed:30}}},conditions:[{kg:{min:1}}]},{rule:{shipping:{addition:{fixed:7}}},conditions:[{kg:{min:10}},{kg:{mult:5,recursive:!0}}]},{rule:{shipping:{value:{fixed:0}}},conditions:[{subtotal:{min:400}}]}];new(function(n){function a(t){var e=this;t=n(t);e.elem={cart:t,productList:t.find(".content-product-list"),couponList:t.find(".content-coupons-list ul"),subtotal:t.find(".subtotal"),shipping:t.find(".shipping"),total:t.find(".total"),couponApply:t.find(".coupon-apply")},e.products={},e.coupons={},i.map(function(t){e.coupons[t.id]=!1}),e.subtotal=0,e.shipping=0,e.total=0,e.events()}return a.prototype={events:function(){var o=this;o.elem.productList.find(".product").on("change",'input[type="text"]',function(){var i=n(this).parents(".product:eq(0)"),e=i.find('input[type="hidden"]').val(),a=parseInt(i.find('input[type="text"]').val()),u=t.filter((t,n)=>t.id==e)[0].price,p=parseFloat(a*u);p>0?o.products[e]={amount:a,total:p}:delete o.products[e],i.find(".total").text("$ "+p),o.invoice()}),o.elem.couponApply.on("click","button",function(){var t=o.elem.couponApply.find('input[type="text"]').val();if(t.length>0){var n=e.filter((n,i)=>n.code==t);if(n.length>0){var a=n[0].id;if(!o.coupons[a]){t=i.filter((t,n)=>t.id==a)[0],o.coupons[t.id]=!0;var u=o.elem.couponList.find(".model").clone(),p=u.find('input[type="hidden"]');u.removeClass("model"),p.val(t.id),p.attr("name","coupon["+a+"]"),u.find(".name").text("Coupon "+t.name),o.elem.couponList.append(u),o.invoice()}}else console.log("coupon not valid")}}),o.elem.couponList.on("click",".coupon-remove",function(){var t=n(this).parents(".coupon:eq(0)"),i=t.find('input[type="hidden"]').val();o.coupons[i]=!1,t.remove(),o.invoice()}),o.elem.cart.on("submit",function(){var t=n(this).serializeArray();console.log(t)})},invoice:function(){var t=this,n={subtotal:Object.values(t.products).reduce((t,n)=>t+n.total,0),shipping:0,amount:Object.values(t.products).reduce((t,n)=>t+n.amount,0)};function e(t,n){var i=n;return i.shipping&&(i.shipping.value&&void 0!==i.shipping.value.fixed&&(t.shipping=i.shipping.value.fixed,t.total=t.subtotal+t.shipping),i.shipping.addition&&void 0!==i.shipping.addition.fixed&&(t.shipping+=i.shipping.addition.fixed,t.total=t.subtotal+t.shipping)),i.subtotal&&i.subtotal.reduce&&void 0!==i.subtotal.reduce.percentage&&(t.subtotal=t.subtotal-t.subtotal*(i.subtotal.reduce.percentage/100),t.total=t.subtotal+t.shipping),i.total&&i.total.reduce&&void 0!==i.total.reduce.fixed&&(t.total=t.total-i.total.reduce.fixed),t}n.total=n.subtotal+n.shipping,o.map(function(t){var i=[],o=1;if(t.conditions.map(function(t){if(t.kg){if(t.kg.max&&i.push(n.amount<=t.kg.max),t.kg.min&&i.push(n.amount>=t.kg.min),t.kg.mult&&i.push(n.amount/t.kg.mult>2),t.kg.recursive){var e=Math.ceil(n.amount/t.kg.mult)-2;o=e>0?e:1}}else t.subtotal&&t.subtotal.min&&i.push(n.subtotal>=t.subtotal.min)}),i.reduce((t,n)=>t&&n))for(var a=0;a<o;a++)n=e(n,t.rule)});var a=[];for(var u in t.coupons)t.coupons[u]&&a.push(u);a.map(function(o){var a=i.filter(t=>t.id==o)[0],u=t.elem.couponList.find('input[type="hidden"][value="'+o+'"]').parents(".coupon:eq(0)"),p=a.text;1==o&&(p="$ -"+n.subtotal*(a.benefit.subtotal.reduce.percentage/100)+" "+p);u.find(".coupon-benefits").text(p);var l=[];if(a.conditions?a.conditions.map(function(t){t.subtotal&&(t.subtotal.min&&l.push(n.subtotal>=t.subtotal.min),t.subtotal.max&&l.push(n.subtotal<t.subtotal.max)),t.total&&t.total.min&&l.push(n.total>=t.total.min)}):l.push(!0),l.reduce((t,n)=>t&&n)){for(var s=0;s<1;s++)n=e(n,a.benefit);u.find(".coupon-benefits").removeClass("error")}else u.find(".coupon-benefits").addClass("error")}),t.elem.subtotal.find(".value").text("$ "+n.subtotal),t.elem.shipping.find(".value").text("$ "+n.shipping),t.elem.total.find(".value").text("$ "+n.total)}},a}(jQuery))(".form-content-cart")});