/*! Application - v0.0.0 - 2019-12-08 */
"use strict";!function(t,e,n){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(e||n)}(function(t){var e=function(e,n,a){var o={invalid:[],getCaret:function(){try{var t,n=0,a=e.get(0),i=document.selection,s=a.selectionStart;return i&&-1===navigator.appVersion.indexOf("MSIE 10")?((t=i.createRange()).moveStart("character",-o.val().length),n=t.text.length):(s||"0"===s)&&(n=s),n}catch(t){}},setCaret:function(t){try{if(e.is(":focus")){var n,a=e.get(0);t+=1,a.setSelectionRange?a.setSelectionRange(t,t):((n=a.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select())}}catch(t){}},events:function(){e.on("keydown.mask",function(t){e.data("mask-keycode",t.keyCode||t.which)}).on(t.jMaskGlobals.useInput?"input.mask":"keyup.mask",o.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){e.keydown().keyup()},100)}).on("change.mask",function(){e.data("changed",!0)}).on("blur.mask",function(){r===o.val()||e.data("changed")||e.trigger("change"),e.data("changed",!1)}).on("blur.mask",function(){r=o.val()}).on("focus.mask",function(e){!0===a.selectOnFocus&&t(e.target).select()}).on("focusout.mask",function(){a.clearIfNotMatch&&!i.test(o.val())&&o.val("")})},getRegexMask:function(){for(var t,e,a,o,i,r,u=[],c=0;c<n.length;c++)(t=s.translation[n.charAt(c)])?(e=t.pattern.toString().replace(/.{1}$|^.{1}/g,""),a=t.optional,(o=t.recursive)?(u.push(n.charAt(c)),i={digit:n.charAt(c),pattern:e}):u.push(a||o?e+"?":e)):u.push(n.charAt(c).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return r=u.join(""),i&&(r=r.replace(new RegExp("("+i.digit+"(.*"+i.digit+")?)"),"($1)?").replace(new RegExp(i.digit,"g"),i.pattern)),new RegExp(r)},destroyEvents:function(){e.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".mask "))},val:function(t){var n,a=e.is("input")?"val":"text";return arguments.length>0?(e[a]()!==t&&e[a](t),n=e):n=e[a](),n},getMCharsBeforeCount:function(t,e){for(var a=0,o=0,i=n.length;o<i&&o<t;o++)s.translation[n.charAt(o)]||(t=e?t+1:t,a++);return a},caretPos:function(t,e,a,i){return s.translation[n.charAt(Math.min(t-1,n.length-1))]?Math.min(t+a-e-i,a):o.caretPos(t+1,e,a,i)},behaviour:function(n){n=n||window.event,o.invalid=[];var a=e.data("mask-keycode");if(-1===t.inArray(a,s.byPassKeys)){var i=o.getCaret(),r=o.val(),u=r.length,c=o.getMasked(),l=c.length,p=o.getMCharsBeforeCount(l-1)-o.getMCharsBeforeCount(u-1),d=i<u&&c!==r;return o.val(c),d&&(8!==a&&46!==a?i=o.caretPos(i,u,l,p):i-=1,o.setCaret(i)),o.callbacks(n)}},getMasked:function(t,e){var i,r,u,c=[],l=void 0===e?o.val():e+"",p=0,d=n.length,f=0,h=l.length,m=1,v="push",g=-1;for(a.reverse?(v="unshift",m=-1,i=0,p=d-1,f=h-1,r=function(){return p>-1&&f>-1}):(i=d-1,r=function(){return p<d&&f<h});r();){var k=n.charAt(p),b=l.charAt(f),y=s.translation[k];y?(b.match(y.pattern)?(c[v](b),y.recursive&&(-1===g?g=p:p===i&&(p=g-m),i===g&&(p-=m)),p+=m):b===u?u=void 0:y.optional?(p+=m,f-=m):y.fallback?(c[v](y.fallback),p+=m,f-=m):o.invalid.push({p:f,v:b,e:y.pattern}),f+=m):(t||c[v](k),b===k?f+=m:u=k,p+=m)}var x=n.charAt(i);return d!==h+1||s.translation[x]||c.push(x),c.join("")},callbacks:function(t){var i=o.val(),s=i!==r,u=[i,t,e,a],c=function(t,e,n){"function"==typeof a[t]&&e&&a[t].apply(this,n)};c("onChange",!0===s,u),c("onKeyPress",!0===s,u),c("onComplete",i.length===n.length,u),c("onInvalid",o.invalid.length>0,[i,t,e,o.invalid,a])}};e=t(e);var i,s=this,r=o.val();n="function"==typeof n?n(o.val(),void 0,e,a):n,s.mask=n,s.options=a,s.remove=function(){var t=o.getCaret();return o.destroyEvents(),o.val(s.getCleanVal()),o.setCaret(t-o.getMCharsBeforeCount(t)),e},s.getCleanVal=function(){return o.getMasked(!0)},s.getMaskedVal=function(t){return o.getMasked(!1,t)},s.init=function(r){if(r=r||!1,a=a||{},s.clearIfNotMatch=t.jMaskGlobals.clearIfNotMatch,s.byPassKeys=t.jMaskGlobals.byPassKeys,s.translation=t.extend({},t.jMaskGlobals.translation,a.translation),s=t.extend(!0,{},s,a),i=o.getRegexMask(),r)o.events(),o.val(o.getMasked());else{a.placeholder&&e.attr("placeholder",a.placeholder),e.data("mask")&&e.attr("autocomplete","off");for(var u=0,c=!0;u<n.length;u++){var l=s.translation[n.charAt(u)];if(l&&l.recursive){c=!1;break}}c&&e.attr("maxlength",n.length),o.destroyEvents(),o.events();var p=o.getCaret();o.val(o.getMasked()),o.setCaret(p+o.getMCharsBeforeCount(p,!0))}},s.init(!e.is("input"))};t.maskWatchers={};var n=function(){var n=t(this),o={},i=n.attr("data-mask");if(n.attr("data-mask-reverse")&&(o.reverse=!0),n.attr("data-mask-clearifnotmatch")&&(o.clearIfNotMatch=!0),"true"===n.attr("data-mask-selectonfocus")&&(o.selectOnFocus=!0),a(n,i,o))return n.data("mask",new e(this,i,o))},a=function(e,n,a){a=a||{};var o=t(e).data("mask"),i=JSON.stringify,s=t(e).val()||t(e).text();try{return"function"==typeof n&&(n=n(s)),"object"!=typeof o||i(o.options)!==i(a)||o.mask!==n}catch(t){}};t.fn.mask=function(n,o){o=o||{};var i=this.selector,s=t.jMaskGlobals,r=s.watchInterval,u=o.watchInputs||s.watchInputs,c=function(){if(a(this,n,o))return t(this).data("mask",new e(this,n,o))};return t(this).each(c),i&&""!==i&&u&&(clearInterval(t.maskWatchers[i]),t.maskWatchers[i]=setInterval(function(){t(document).find(i).each(c)},r)),this},t.fn.masked=function(t){return this.data("mask").getMaskedVal(t)},t.fn.unmask=function(){return clearInterval(t.maskWatchers[this.selector]),delete t.maskWatchers[this.selector],this.each(function(){var e=t(this).data("mask");e&&e.remove().removeData("mask")})},t.fn.cleanVal=function(){return this.data("mask").getCleanVal()},t.applyDataMask=function(e){((e=e||t.jMaskGlobals.maskElements)instanceof t?e:t(e)).filter(t.jMaskGlobals.dataMaskAttr).each(n)};var o,i,s,r={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,useInput:(o="input",s=document.createElement("div"),(i=(o="on"+o)in s)||(s.setAttribute(o,"return;"),i="function"==typeof s[o]),s=null,i),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};t.jMaskGlobals=t.jMaskGlobals||{},(r=t.jMaskGlobals=t.extend(!0,{},r,t.jMaskGlobals)).dataMask&&t.applyDataMask(),setInterval(function(){t.jMaskGlobals.watchDataMask&&t.applyDataMask()},r.watchInterval)},window.jQuery,window.Zepto),function(t){t(document).ready(function(){t("body").on("focus",".phone",function(){var e=function(t){return 11===t.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},n={onKeyPress:function(t,n,a,o){a.mask(e.apply({},arguments),o)}};t(this).mask(e,n)}),t("body").on("focus",".mail",function(){t(this).mask("A",{translation:{A:{pattern:/[\w@\-._]/,recursive:!0}}})}),t("body").on("focus",".ncm",function(){t(this).mask("0000.0000")}),t("body").on("focus",".cep",function(){t(this).mask("00000-000")}),t("body").on("focus",".date",function(){t(this).mask("00/00/0000")}),t("body").on("click",".date",function(e){t(this).datepicker({showOtherMonths:!0,showButtonPanel:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,language:"pt"}),t(this).datepicker("show")}),t("body").on("focus",".hora",function(){t(this).mask("00:00")}),t("body").on("focus",".cnpj",function(){t(this).mask("00.000.000/0000-00")}),t("body").on("focus",".cpf",function(){t(this).mask("000.000.000-00")}),t("body").on("focus",".rg",function(){t(this).mask("00.000.000-0")}),t("body").on("focus",".money",function(){t(this).mask("#.##0,00",{reverse:!0})}),t("body").on("focus",".onlyNumber",function(){t(this).mask("#")})})}(jQuery);var AmountComponent=function(t){function e(e){this.element=t(e),this.callback=[],this.events()}return e.prototype={addCallback:function(t){this.callback.push(t)},events:function(){var e=this;e.element.on("change","input",function(){var t=parseInt(this.value.replace(/[^\d+-]/g,""));(isNaN(t)||t<0)&&(this.value=0)}),e.element.on("click",".up",function(){var n=e.element.find("input");n.val(parseInt(n.val())+1),t(n).trigger("change")}),e.element.on("click",".down",function(){var n=e.element.find("input");n.val(parseInt(n.val())-1),t(n).trigger("change")})}},t.fn.AmountComponent=function(){new e(this)},e}(jQuery);$(document).ready(function(){$(".amount-component").map(function(t,e){new AmountComponent(this)})}),$(document).ready(function(){var t=[{id:1,name:"Apple",price:20},{id:2,name:"Banana",price:10},{id:3,name:"Orange",price:30}],e=$(".content-product-list ul");t.map(function(t,n){var a=e.find(".model").clone();a.removeClass("model"),a.find('input[type="hidden"]').val(t.id),a.find(".name").text(t.name),a.find(".unit").text("$ "+t.price),a.find(".total").text("$ 0"),a.find(".amount-component input").attr("name","amount["+t.id+"]"),a.find(".amount").AmountComponent(),e.append(a)});var n=[{id:1,name:"A",text:"(30%)",benefit:{subtotal:{reduce:{percentage:30}}}},{id:2,name:"FOO",text:"$ 100",benefit:{total:{reduce:{fixed:100}}},conditions:[{total:{min:101}}]},{id:3,name:"C",text:"Free Shipping",benefit:{shipping:{value:{fixed:0}}},conditions:[{subtotal:{min:300.5,max:400}}]}],a=[{code:"111",id:1},{code:"222",id:2},{code:"333",id:3}],o=[{rule:{shipping:{value:{fixed:30}}},conditions:[{kg:{min:1}}]},{rule:{shipping:{addition:{fixed:7}}},conditions:[{kg:{min:10}},{kg:{mult:5,recursive:!0}}]},{rule:{shipping:{value:{fixed:0}}},conditions:[{subtotal:{min:400}}]}];new(function(e){function i(t){var a=this;t=e(t);a.elem={cart:t,productList:t.find(".content-product-list"),couponList:t.find(".content-coupons-list ul"),subtotal:t.find(".subtotal"),shipping:t.find(".shipping"),total:t.find(".total"),couponApply:t.find(".coupon-apply")},a.products={},a.coupons={},n.map(function(t){a.coupons[t.id]=!1}),a.subtotal=0,a.shipping=0,a.total=0,a.events()}return i.prototype={events:function(){var o=this;o.elem.productList.find(".product").on("change",'input[type="text"]',function(){var n=e(this).parents(".product:eq(0)"),a=n.find('input[type="hidden"]').val(),i=parseInt(n.find('input[type="text"]').val()),s=t.filter((t,e)=>t.id==a)[0].price,r=parseFloat(i*s);r>0?o.products[a]={amount:i,total:r}:delete o.products[a],n.find(".total").text("$ "+r),o.invoice()}),o.elem.couponApply.on("click","button",function(){var t=o.elem.couponApply.find('input[type="text"]').val();if(t.length>0){var e=a.filter((e,n)=>e.code==t);if(e.length>0){var i=e[0].id;if(!o.coupons[i]){t=n.filter((t,e)=>t.id==i)[0],o.coupons[t.id]=!0;var s=o.elem.couponList.find(".model").clone(),r=s.find('input[type="hidden"]');s.removeClass("model"),r.val(t.id),r.attr("name","coupon["+i+"]"),s.find(".name").text("Coupon "+t.name),o.elem.couponList.append(s),o.invoice()}}else console.log("coupon not valid")}}),o.elem.couponList.on("click",".coupon-remove",function(){var t=e(this).parents(".coupon:eq(0)"),n=t.find('input[type="hidden"]').val();o.coupons[n]=!1,t.remove(),o.invoice()}),o.elem.cart.on("submit",function(){var t=e(this).serializeArray();console.log(t)})},invoice:function(){var t=this,e={subtotal:Object.values(t.products).reduce((t,e)=>t+e.total,0),shipping:0,amount:Object.values(t.products).reduce((t,e)=>t+e.amount,0)};function a(t,e){var n=e;return n.shipping&&(n.shipping.value&&void 0!==n.shipping.value.fixed&&(t.shipping=n.shipping.value.fixed,t.total=t.subtotal+t.shipping),n.shipping.addition&&void 0!==n.shipping.addition.fixed&&(t.shipping+=n.shipping.addition.fixed,t.total=t.subtotal+t.shipping)),n.subtotal&&n.subtotal.reduce&&void 0!==n.subtotal.reduce.percentage&&(t.subtotal=t.subtotal-t.subtotal*(n.subtotal.reduce.percentage/100),t.total=t.subtotal+t.shipping),n.total&&n.total.reduce&&void 0!==n.total.reduce.fixed&&(t.total=t.total-n.total.reduce.fixed),t}e.total=e.subtotal+e.shipping,o.map(function(t){var n=[],o=1;if(t.conditions.map(function(t){if(t.kg){if(t.kg.max&&n.push(e.amount<=t.kg.max),t.kg.min&&n.push(e.amount>=t.kg.min),t.kg.mult&&n.push(e.amount/t.kg.mult>2),t.kg.recursive){var a=Math.ceil(e.amount/t.kg.mult)-2;o=a>0?a:1}}else t.subtotal&&t.subtotal.min&&n.push(e.subtotal>=t.subtotal.min)}),n.reduce((t,e)=>t&&e))for(var i=0;i<o;i++)e=a(e,t.rule)});var i=[];for(var s in t.coupons)t.coupons[s]&&i.push(s);i.map(function(o){var i=n.filter(t=>t.id==o)[0],s=t.elem.couponList.find('input[type="hidden"][value="'+o+'"]').parents(".coupon:eq(0)"),r=i.text;1==o&&(r="$ -"+e.subtotal*(i.benefit.subtotal.reduce.percentage/100)+" "+r);s.find(".coupon-benefits").text(r);var u=[];if(i.conditions?i.conditions.map(function(t){t.subtotal&&(t.subtotal.min&&u.push(e.subtotal>=t.subtotal.min),t.subtotal.max&&u.push(e.subtotal<t.subtotal.max)),t.total&&t.total.min&&u.push(e.total>=t.total.min)}):u.push(!0),u.reduce((t,e)=>t&&e)){for(var c=0;c<1;c++)e=a(e,i.benefit);s.find(".coupon-benefits").removeClass("error")}else s.find(".coupon-benefits").addClass("error")}),t.elem.subtotal.find(".value").text("$ "+e.subtotal),t.elem.shipping.find(".value").text("$ "+e.shipping),t.elem.total.find(".value").text("$ "+e.total)}},i}(jQuery))(".form-content-cart")});